(function(){var a=function(){},b=function(){return a.apply(this,arguments)};b._debug=!1,b.get_time=function(){return(new Date).getTime()},b.close_to=function(a,b,c){return Math.abs(a-b)<c},b.Types={},b.define_type=function(a,c){b.Types[a]=c},b.get_type=function(a){return b.Types[a]},b.factories={},b.define_factory=function(a,c){b.factories[a]=c},b.create=function(a){var c,d=arguments.length,e=[];for(c=1;c<d;c++)e.push(arguments[c]);var f=b.factories[a];return f.apply(this,e)},window.BrawlIO=b})(),function(){function A(a,b,c){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(w.isFunction(a.isEqual))return a.isEqual(b);if(w.isFunction(b.isEqual))return b.isEqual(a);var d=i.call(a);if(d!=i.call(b))return!1;switch(d){case"[object String]":return String(a)==String(b);case"[object Number]":return a=+a,b=+b,a!=a?b!=b:a==0?1/a==1/b:a==b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var e=c.length;while(e--)if(c[e]==a)return!0;c.push(a);var f=0,g=!0;if(d=="[object Array]"){f=a.length,g=f==b.length;if(g)while(f--)if(!(g=f in a==f in b&&A(a[f],b[f],c)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var h in a)if(j.call(a,h)){f++;if(!(g=j.call(b,h)&&A(a[h],b[h],c)))break}if(g){for(h in b)if(j.call(b,h)&&!(f--))break;g=!f}}return c.pop(),g}var a=BrawlIO,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.slice,h=d.unshift,i=e.toString,j=e.hasOwnProperty,k=d.forEach,l=d.map,m=d.reduce,n=d.reduceRight,o=d.filter,p=d.every,q=d.some,r=d.indexOf,s=d.lastIndexOf,t=Array.isArray,u=Object.keys,v=f.bind,w=function(a){return new C(a)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=w),exports._=w):typeof define=="function"&&define.amd?define("underscore",function(){return w}):a._=w,w.VERSION="1.2.2";var x=w.each=w.forEach=function(a,b,d){if(a==null)return;if(k&&a.forEach===k)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(e in a&&b.call(d,a[e],e,a)===c)return}else for(var g in a)if(j.call(a,g)&&b.call(d,a[g],g,a)===c)return};w.map=function(a,b,c){var d=[];return a==null?d:l&&a.map===l?a.map(b,c):(x(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)},w.reduce=w.foldl=w.inject=function(a,b,c,d){var e=c!==void 0;a==null&&(a=[]);if(m&&a.reduce===m)return d&&(b=w.bind(b,d)),e?a.reduce(b,c):a.reduce(b);x(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},w.reduceRight=w.foldr=function(a,b,c,d){a==null&&(a=[]);if(n&&a.reduceRight===n)return d&&(b=w.bind(b,d)),c!==void 0?a.reduceRight(b,c):a.reduceRight(b);var e=(w.isArray(a)?a.slice():w.toArray(a)).reverse();return w.reduce(e,b,c,d)},w.find=w.detect=function(a,b,c){var d;return y(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},w.filter=w.select=function(a,b,c){var d=[];return a==null?d:o&&a.filter===o?a.filter(b,c):(x(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},w.reject=function(a,b,c){var d=[];return a==null?d:(x(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},w.every=w.all=function(a,b,d){var e=!0;return a==null?e:p&&a.every===p?a.every(b,d):(x(a,function(a,f,g){if(!(e=e&&b.call(d,a,f,g)))return c}),e)};var y=w.some=w.any=function(a,b,d){b=b||w.identity;var e=!1;return a==null?e:q&&a.some===q?a.some(b,d):(x(a,function(a,f,g){if(e||(e=b.call(d,a,f,g)))return c}),!!e)};w.include=w.contains=function(a,b){var c=!1;return a==null?c:r&&a.indexOf===r?a.indexOf(b)!=-1:(c=y(a,function(a){return a===b}),c)},w.invoke=function(a,b){var c=g.call(arguments,2);return w.map(a,function(a){return(b.call?b||a:a[b]).apply(a,c)})},w.pluck=function(a,b){return w.map(a,function(a){return a[b]})},w.max=function(a,b,c){if(!b&&w.isArray(a))return Math.max.apply(Math,a);if(!b&&w.isEmpty(a))return-Infinity;var d={computed:-Infinity};return x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},w.min=function(a,b,c){if(!b&&w.isArray(a))return Math.min.apply(Math,a);if(!b&&w.isEmpty(a))return Infinity;var d={computed:Infinity};return x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},w.shuffle=function(a){var b=[],c;return x(a,function(a,d,e){d==0?b[0]=a:(c=Math.floor(Math.random()*(d+1)),b[d]=b[c],b[c]=a)}),b},w.sortBy=function(a,b,c){return w.pluck(w.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},w.groupBy=function(a,b){var c={},d=w.isFunction(b)?b:function(a){return a[b]};return x(a,function(a,b){var e=d(a,b);(c[e]||(c[e]=[])).push(a)}),c},w.sortedIndex=function(a,b,c){c||(c=w.identity);var d=0,e=a.length;while(d<e){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},w.toArray=function(a){return a?a.toArray?a.toArray():w.isArray(a)?g.call(a):w.isArguments(a)?g.call(a):w.values(a):[]},w.size=function(a){return w.toArray(a).length},w.first=w.head=function(a,b,c){return b!=null&&!c?g.call(a,0,b):a[0]},w.initial=function(a,b,c){return g.call(a,0,a.length-(b==null||c?1:b))},w.last=function(a,b,c){return b!=null&&!c?g.call(a,Math.max(a.length-b,0)):a[a.length-1]},w.rest=w.tail=function(a,b,c){return g.call(a,b==null||c?1:b)},w.compact=function(a){return w.filter(a,function(a){return!!a})},w.flatten=function(a,b){return w.reduce(a,function(a,c){return w.isArray(c)?a.concat(b?c:w.flatten(c)):(a[a.length]=c,a)},[])},w.without=function(a){return w.difference(a,g.call(arguments,1))},w.uniq=w.unique=function(a,b,c){var d=c?w.map(a,c):a,e=[];return w.reduce(d,function(c,d,f){if(0==f||(b===!0?w.last(c)!=d:!w.include(c,d)))c[c.length]=d,e[e.length]=a[f];return c},[]),e},w.union=function(){return w.uniq(w.flatten(arguments,!0))},w.intersection=w.intersect=function(a){var b=g.call(arguments,1);return w.filter(w.uniq(a),function(a){return w.every(b,function(b){return w.indexOf(b,a)>=0})})},w.difference=function(a,b){return w.filter(a,function(a){return!w.include(b,a)})},w.zip=function(){var a=g.call(arguments),b=w.max(w.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=w.pluck(a,""+d);return c},w.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c)return d=w.sortedIndex(a,b),a[d]===b?d:-1;if(r&&a.indexOf===r)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1},w.lastIndexOf=function(a,b){if(a==null)return-1;if(s&&a.lastIndexOf===s)return a.lastIndexOf(b);var c=a.length;while(c--)if(a[c]===b)return c;return-1},w.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);while(e<d)f[e++]=a,a+=c;return f};var z=function(){};w.bind=function(a,b){var c,d;if(a.bind===v&&v)return v.apply(a,g.call(arguments,1));if(!w.isFunction(a))throw new TypeError;return d=g.call(arguments,2),c=function(){if(this instanceof c){z.prototype=a.prototype;var e=new z,f=a.apply(e,d.concat(g.call(arguments)));return Object(f)===f?f:e}return a.apply(b,d.concat(g.call(arguments)))}},w.bindAll=function(a){var b=g.call(arguments,1);return b.length==0&&(b=w.functions(a)),x(b,function(b){a[b]=w.bind(a[b],a)}),a},w.memoize=function(a,b){var c={};return b||(b=w.identity),function(){var d=b.apply(this,arguments);return j.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},w.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},w.defer=function(a){return w.delay.apply(w,[a,1].concat(g.call(arguments,1)))},w.throttle=function(a,b){var c,d,e,f,g,h=w.debounce(function(){g=f=!1},b);return function(){c=this,d=arguments;var i=function(){e=null,g&&a.apply(c,d),h()};e||(e=setTimeout(i,b)),f?g=!0:a.apply(c,d),h(),f=!0}},w.debounce=function(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}},w.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}},w.wrap=function(a,b){return function(){var c=[a].concat(g.call(arguments));return b.apply(this,c)}},w.compose=function(){var a=g.call(arguments);return function(){var b=g.call(arguments);for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},w.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},w.keys=u||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)j.call(a,c)&&(b[b.length]=c);return b},w.values=function(a){return w.map(a,w.identity)},w.functions=w.methods=function(a){var b=[];for(var c in a)w.isFunction(a[c])&&b.push(c);return b.sort()},w.extend=function(a){return x(g.call(arguments,1),function(b){for(var c in b)b[c]!==void 0&&(a[c]=b[c])}),a},w.defaults=function(a){return x(g.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},w.clone=function(a){return w.isObject(a)?w.isArray(a)?a.slice():w.extend({},a):a},w.tap=function(a,b){return b(a),a},w.isEqual=function(a,b){return A(a,b,[])},w.isEmpty=function(a){if(w.isArray(a)||w.isString(a))return a.length===0;for(var b in a)if(j.call(a,b))return!1;return!0},w.isElement=function(a){return!!a&&a.nodeType==1},w.isArray=t||function(a){return i.call(a)=="[object Array]"},w.isObject=function(a){return a===Object(a)},i.call(arguments)=="[object Arguments]"?w.isArguments=function(a){return i.call(a)=="[object Arguments]"}:w.isArguments=function(a){return!!a&&!!j.call(a,"callee")},w.isFunction=function(a){return i.call(a)=="[object Function]"},w.isString=function(a){return i.call(a)=="[object String]"},w.isNumber=function(a){return i.call(a)=="[object Number]"},w.isNaN=function(a){return a!==a},w.isBoolean=function(a){return a===!0||a===!1||i.call(a)=="[object Boolean]"},w.isDate=function(a){return i.call(a)=="[object Date]"},w.isRegExp=function(a){return i.call(a)=="[object RegExp]"},w.isNull=function(a){return a===null},w.isUndefined=function(a){return a===void 0},w.noConflict=function(){return a._=b,this},w.identity=function(a){return a},w.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},w.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},w.mixin=function(a){x(w.functions(a),function(b){E(b,w[b]=a[b])})};var B=0;w.uniqueId=function(a){var b=B++;return a?a+b:b},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},w.template=function(a,b){var c=w.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.escape,function(a,b){return"',_.escape("+b.replace(/\\'/g,"'")+"),'"}).replace(c.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",e=new Function("obj","_",d);return b?e(b,w):function(a){return e(a,w)}};var C=function(a){this._wrapped=a};w.prototype=C.prototype;var D=function(a,b){return b?w(a).chain():a},E=function(a,b){C.prototype[a]=function(){var a=g.call(arguments);return h.call(a,this._wrapped),D(b.apply(w,a),this._chain)}};w.mixin(w),x(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];C.prototype[a]=function(){return b.apply(this._wrapped,arguments),D(this._wrapped,this._chain)}}),x(["concat","join","slice"],function(a){var b=d[a];C.prototype[a]=function(){return D(b.apply(this._wrapped,arguments),this._chain)}}),C.prototype.chain=function(){return this._chain=!0,this},C.prototype.value=function(){return this._wrapped}}.call(this),function(a){var b=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=function(){var c,d=this.hasOwnProperty("super_constructor");d&&(c=this.super_constructor),this.super_constructor=b.constructor;var e=a.apply(this,arguments);return d?this.super_constructor=c:delete this.super_constructor,e},a.superclass=b,a.superproto=b.prototype};a.oo_extend=b}(BrawlIO),function(a){var b=function(a){var b=0,c=[];a.on=a.add_event_listener=function(a,d){var e={type:a,callback:d,id:b};return c.push(e),b++,e.id},a.remove_event_listener=function(a){var b;for(b=0;b<c.length;b++){var d=c[b];if(d.id===a||d.callback===a)return c.splice(b,1),!0}},a.emit=function(a){var b=a.type,d,e=c.length;for(d=0;d<e;d++){var f=c[d];f.type===b&&f.callback(a)}},a.once=function(b,c){var d;d=a.on(b,function(){c.apply(a,arguments),a.remove_event_listener(d)})},a.clear_listeners=function(a){if(arguments.lenth===0)c=[];else{var b;for(b=0;b<c.length;b++){var d=c[b];d.type===a&&(c.splice(b,1),b--)}}}};a.make_listenable=b}(BrawlIO),function(a){var b=1e-6,c=function(c,d,e,f,g){var h,i,j,k,l;f=f||1e-5,g=g||1e-5,h=c(d);if(a.close_to(h,0,f))return d;i=c(e);if(a.close_to(i,0,f))return e;while(!a.close_to(d,e,g)){k=(i-h)/(e-d);if(a.close_to(k,0,b))return!1;l=e-i/k,j=c(l);if(a.close_to(j,0,f))break;d=e,h=i,e=l,i=j}return l};a.root_finder=c}(BrawlIO),function(a){var b=function(a){this.type=a.type};(function(a){var b=a.prototype;b.is=function(a){return this.type===a}})(b),a.define_type("Path",b)}(BrawlIO),function(a){var b=a._,c=a.get_type("Path"),d=function(a){this.super_constructor.call(this,b.extend({type:"vector"},a)),this.x=a.x,this.y=a.y};a.oo_extend(d,c),function(a){a.fromComponents=function(a,b){return new d({x:a,y:b})},a.fromMagnitudeAndTheta=function(a,b){var c=a*Math.cos(b),e=a*Math.sin(b);return new d({x:c,y:e})},a.fromPoints=function(a,b,c,e){var f=c-a,g=e-b;return new d({x:f,y:g})};var b=a.prototype;b.normalize=function(b){return b===undefined&&(b=1),a.fromMagnitudeAndTheta(b,this.get_theta())},b.neg=function(){return a.fromComponents(-this.x,-this.y)},b.get_magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},b.get_theta=function(){return Math.atan2(this.y,this.x)},b.add=function(b){return a.fromComponents(this.x+b.x,this.y+b.y)},b.subtract=function(b){return a.fromComponents(this.x-b.x,this.y-b.y)},b.cross=function(a){return this.x*a.y-a.x*this.y},b.dot=function(a){return this.x*a.x+this.y*a.y},b.get_x=function(){return this.x},b.get_y=function(){return this.y}}(d),a.define_type("Vector",d),a.define_factory("line_segment_from_points",function(){return d.fromMagnitudeAndTheta.apply(d,arguments)}),a.define_factory("line_segment_from_points",function(){return d.fromPoints.apply(d,arguments)})}(BrawlIO),function(a){var b=a._,c=a.get_type("Path"),d=a.get_type("Vector"),e=function(a){this.super_constructor.call(this,b.extend({type:"line"},a)),this.a=a.a,this.b=a.b,this.c=a.c};a.oo_extend(e,c),function(b){b.fromPointAndAngle=function(a,b,c){return new e({a:Math.sin(c),b:-Math.cos(c),c:b*Math.cos(c)-a*Math.sin(c)})},b.fromPoints=function(a,b){return new e({a:a.y-b.y,b:b.x-a.x,c:a.x*b.y-b.x*a.y})};var c=b.prototype,f=function(a){if(a.is("line"))return a;if(a.is("line_segment"))return a.get_line();if(a.is("ray"))return a.get_line()};c.intersects_with=function(a,b){var c=f(this),d=f(a),e,g,h=c.a*d.b-c.b*d.a;if(h===0){if(b===undefined)return c.a===d.a&&c.b===d.b&&c.c===d.c?!0:!1;var i=Math.abs(c.c-d.c);return i<b?!0:!1}e=c.b*d.c-d.b*c.c,g=d.a*c.c-c.a*d.c;var j=e/h,k=g/h;if(!this.includes_point(j,k)||!a.includes_point(j,k))return!1;if(b===undefined)return[{x:j,y:k}];var l=this.get_theta(),m=a.get_theta(),n=Math.sin(l)*Math.cos(m)-Math.sin(m)*Math.cos(l),o=b*Math.cos(l)/n,p=b*Math.sin(l)/n;return[{x:j-o,y:k-p},{x:j+o,y:k+p}]},c.distance_to=function(a){return Math.abs(this.a*a.x+this.b*a.y+this.c)/Math.sqrt(Math.pow(this.a,2)+Math.pow(this.b,2))},c.get_theta=function(){return this.b===0?this.a>0?Math.PI/2:-Math.PI/2:Math.atan2(-this.a,this.b)},c.includes_point=function(b,c){return a.close_to(this.a*b+this.b*c+this.c,0)},c.get_normals=function(){var a=this.get_theta(),b=a+Math.PI/2,c=a-Math.PI/2;return[d.fromMagnitudeAndTheta(1,b),d.fromMagnitudeAndTheta(1,c)]},c.shift_by=function(a,b){var c=this.c+this.a*a+this.b*b;return new e({a:this.a,b:this.b,c:c})}}(e),a.define_type("Line",e),a.define_factory("line_from_points",function(){return e.fromPoints.apply(e,arguments)})}(BrawlIO),function(a){var b=a.get_type("Path"),c=a.get_type("Line"),d=a._,e=function(a,b,c){var d=1e-6;return a>=b-d&&a<=c+d||a>=c-d&&a<=b+d},f=function(a){this.super_constructor.call(this,d.extend({type:"line_segment"},a)),this.p0=a.p0,this.p1=a.p1,this.along_line=c.fromPoints(this.p0,this.p1)};a.oo_extend(f,b),function(a){a.fromPoints=function(a,b){return new f({p0:a,p1:b})};var b=a.prototype;b.intersects_with=function(a,b){return c.prototype.intersects_with.apply(this,arguments)},b.get_theta=function(){return this.along_line.get_theta()},b.get_line=function(){return this.along_line},b.includes_point=function(a,b){var c=this.get_line();return c.includes_point(a,b)?e(a,this.p0.x,this.p1.x)&&e(b,this.p0.y,this.p1.y):!1},b.distance_to=function(a){var b=this.get_line();return b.distance_to(a)},b.get_center_point=function(){return{x:(this.p0.x+this.p1.x)/2,y:(this.p0.y+this.p1.y)/2}},b.shift_by=function(b,c){var d={x:this.p0.x+b,y:this.p0.y+c},e={x:this.p1.x+b,y:this.p1.y+c};return a.fromPoints(d,e)},b.shift_by_vector=function(a){return this.shift_by(a.get_x(),a.get_y())}}(f),a.define_type("LineSegment",f),a.define_factory("line_segment_from_points",function(){return f.fromPoints.apply(f,arguments)})}(BrawlIO),function(a){var b=a.get_type("Path"),c=a.get_type("Line"),d=a._,e=function(a){this.super_constructor.call(this,d.extend({type:"ray"},a)),this.p0=a.p0,this.theta=a.theta,this.along_line=c.fromPointAndAngle(this.p0.x,this.p0.y,this.theta)};a.oo_extend(e,b),function(a){a.fromPointAndAngle=function(a,b,c){return new e({p0:{x:a,y:b},theta:c})},a.fromPointAndVector=function(a,b,c){var d=c.get_theta();return new e({p0:{x:a,y:b},theta:d})};var b=a.prototype;b.intersects_with=function(a,b){return c.prototype.intersects_with.apply(this,arguments)},b.get_theta=function(){return this.theta},b.get_line=function(){return this.along_line},b.includes_point=function(a,b){var c=this.get_line(),d=this.get_theta();if(!c.includes_point(a,b))return!1;var e={x:this.p0.x+Math.cos(d),y:this.p0.y+Math.sin(d)},f=e.x-this.p0.x,g=e.y-this.p0.y,h=a-this.p0.x,i=b-this.p0.y,j=f*h>=0,k=g*i>=0;return j&&k},b.distance_to=function(a){var b=this.get_line();return b.distance_to(a)}}(e),a.define_type("Ray",e),a.define_factory("ray_from_point_and_angle",function(){return e.fromPointAndAngle.apply(e,arguments)}),a.define_factory("ray_from_point_and_vector",function(){return e.fromPointAndVector.apply(e,arguments)})}(BrawlIO),function(a){var b=a._,c=a.get_type("Path"),d=function(a){this.super_constructor.call(this,b.extend({type:"circle"},a)),this.cx=a.center_x,this.cy=a.center_y,this.r=a.radius};a.oo_extend(d,c);var e=1e-6;(function(a){a.fromPointAngleAndVelocity=function(a,b,c,e,f){var g=e/f;return new d({center_x:a+g*Math.sin(c),center_y:b+g*Math.cos(c),r:e/f})},a.fromCenterAndRadius=function(a,b,c){return new d({center_x:a,center_y:b,radius:c})};var c=a.prototype;c.get_cx=function(){return this.cx},c.get_cy=function(){return this.cy},c.get_radius=function(){return this.r},c.add_radius=function(b){return a.fromCenterAndRadius(this.get_cx(),this.get_cy(),this.get_radius()+b)},c.intersects_with_line=function(a){if(a.distance_to({x:this.get_cx(),y:this.get_cy()})>this.get_radius()+e)return!1;var c=a.shift_by(this.get_cx(),this.get_cy()),d=c.a,f=c.b,g=c.c,h=this.get_radius(),i=Math.pow(h,2)*(Math.pow(d,2)+Math.pow(f,2))-Math.pow(g,2);if(i<0)return!1;var j=[],k=Math.pow(d,2)+Math.pow(f,2);if(i===0){var l=-d*g/k,m=-f*g/k;j.push({x:l,y:m})}else if(i>0){var n=Math.sqrt(i),o=(-d*g+f*n)/k,p=(-f*g+d*n)/k,q=(-d*g-f*n)/k,r=(-f*g-d*n)/k;j.push({x:o,y:p}),j.push({x:q,y:r})}var s=this.get_cx(),t=this.get_cy();return b.map(j,function(a){return{x:a.x+s,y:a.y+t}})},c.intersects_with_line_segment=function(a){var c=a.get_line(),d=this.intersects_with_line(c);return d===!1?!1:b.filter(d,function(b){return a.includes_point(b.x,b.y)})}})(d),a.define_type("Circle",d),a.define_factory("circle_from_center_and_radius",function(){return d.fromCenterAndRadius.apply(d,arguments)})}(BrawlIO),function(a){var b=function(a){this.name="none"};(function(a){var b=a.prototype;b.get_name=function(){return this.name},b.is=function(a){return this.name===a}})(b),a.define_type("Shape",b)}(BrawlIO),function(a){var b=a.get_type("Shape"),c=function(a){this.super_constructor.call(this,a),this.radius=a.radius,this.cx=a.x,this.cy=a.y,this.name="circle"};a.oo_extend(c,b),function(a){var b=a.prototype;b.get_radius=function(){return this.radius}}(c),a.define_type("CircleShape",c),a.define_constructor("circle_shape",function(a){return new c(a)})}(BrawlIO),function(a){var b=a.get_type("Shape"),c=a._,d=function(b){this.super_constructor.call(this,b),this.inverted=b.inverted;var d=b.points;this.line_segments=c.map(d,function(b,c){var e=(c+1)%d.length,f=d[e];return a.create("line_segment_from_points",b,f)}),this.name="polygon"};a.oo_extend(d,b),function(b){var d=b.prototype;d.get_line_segments=function(){return this.line_segments},d.get_normal=function(b){var d=c.without(this.get_line_segments(),b),e=b.get_line().get_normals(),f=b.get_center_point(),g=c.map(e,function(b){return a.create("ray_from_point_and_vector",f.x,f.y,b)}),h=this.inverted,i=c.map(g,function(a){var b=0;c.forEach(d,function(c){c.intersects_with(a)&&b++});var e=b%2===0;return h?!e:e}),j=c.indexOf(i,!0);return e[j]}}(d),a.define_type("Polygon",d),a.define_factory("polygon",function(a){return new d(a)})}(BrawlIO),function(a){var b=a.close_to,c=function(a,b){while(a>b)a-=2*Math.PI;while(a<b)a+=2*Math.PI;return a},d=function(a,b){while(a<b)a+=2*Math.PI;while(a>b)a-=2*Math.PI;return a},e=function(a){this.x0=a.x0,this.y0=a.y0,this.debug_info=a.debug_info,this.name="generic_movement_path"};(function(a){var b=a.prototype;b.get_position=function(a){return{x:0,y:0}},b.is=function(a){return this.type===a}})(e);var f=function(a){this.super_constructor.call(this,a),this.type="stationary"};a.oo_extend(f,e),function(a){var b=a.prototype;b.get_position=function(a){return{x:this.x0,y:this.y0}}}(f);var g=function(a){this.super_constructor.call(this,a),this.angle=a.angle,this.speed=a.speed,this.init(),this.type="constant_velocity_line"};a.oo_extend(g,e),function(c){var d=c.prototype;d.init=function(){this.cos_angle=Math.cos(this.angle),this.sin_angle=Math.sin(this.angle)},d.get_position=function(a){var b=a*this.speed,c=b*this.cos_angle,d=b*this.sin_angle;return{x:this.x0+c,y:this.y0+d}},d.get_ray=function(){return a.create("ray_from_point_and_angle",this.x0,this.y0,this.angle)},d.get_vector=function(){return a.create("vector_from_magnitude_and_angle",this.speed,this.angle)},d.get_line=function(){return a.create("line_from_point_and_angle",this.x0,this.y0,this.angle)},d.delta_t_until_x_is=function(a){var c=this.speed*Math.cos(this.angle);if(b(c,0))return b(this.x0,a)?0:!1;var d=(a-this.x0)/c;return d<0?!1:d},d.delta_t_until_y_is=function(a){var c=this.speed*Math.sin(this.angle);if(b(c,0))return b(this.y0,a)?0:!1;var d=(a-this.y0)/c;return d<0?!1:d},d.delta_t_until_at=function(a,b){var c=this.delta_t_until_x_is(a);if(c===!1)return!1;var d=this.delta_t_until_y_is(b);if(d===!1)return!1;var e=Math.max(c,d);return e<=0?!1:e}}(g);var h=function(a){this.super_constructor.call(this,a),this.movement_angle=a.movement_angle,this.speed=a.speed,this.rotational_speed=a.rotational_speed,this.init(),this.type="constant_velocity_circle"};a.oo_extend(h,e),function(b){var e=b.prototype;e.init=function(){this.clockwise=this.rotational_speed>0,this.r=this.speed/this.rotational_speed,this.center_x=this.x0+this.r*Math.sin(-this.movement_angle),this.center_y=this.y0+this.r*Math.cos(-this.movement_angle),this.r=Math.abs(this.r),this.clockwise?this.angle=this.movement_angle-Math.PI/2:this.angle=this.movement_angle+Math.PI/2},e.get_rotational_speed=function(){return this.rotational_speed},e.get_translational_speed=function(){return this.speed},e.get_position=function(a){var b=this.rotational_speed*a,c=this.angle+b,d={x:this.center_x+this.r*Math.cos(c),y:this.center_y+this.r*Math.sin(c)};return d},e.delta_t_until_at=function(a,b){var e=a-this.center_x,f=b-this.center_y,g=Math.atan2(f,e);this.clockwise?g=c(g,this.angle):g=d(g,this.angle);var h=g-this.angle,i=h/this.rotational_speed;return i},e.get_circle=function(){return a.create("circle_from_center_and_radius",this.center_x,this.center_y,this.r)},e.get_vector=function(b){var c=this.movement_angle+b*this.rotational_speed;return a.create("vector_from_magnitude_and_angle",this.speed,c)}}(h);var i=function(a){this.super_constructor.call(this,a),this.type="sinusoidal_velocity_line",this.x0=a.x0,this.y0=a.y0,this.movement_angle=a.movement_angle,this.rotational_speed=a.rotational_speed,this.speed=a.speed,this.initial_theta=a.initial_theta,this.initial_circle_theta=a.initial_circle_theta,this.init()};a.oo_extend(i,e),function(e){var f=e.prototype;f.init=function(){this.clockwise=this.rotational_speed>0,this.cos_movement_angle=Math.cos(this.movement_angle),this.sin_movement_angle=Math.sin(this.movement_angle),this.initial_distance=this.speed/this.rotational_speed*Math.sin(this.initial_theta)},f.get_position=function(a){var b=this.initial_theta+a*this.rotational_speed,c=this.speed/this.rotational_speed*Math.sin(b)-this.initial_distance,d=c*this.cos_movement_angle,e=c*this.sin_movement_angle;return{x:this.x0+d,y:this.y0+e}},f.get_line=function(){return a.create("line_from_point_and_angle",this.x0,this.y0,this.movement_angle)},f.get_line_segment_range=function(){var b=-(this.speed/this.rotational_speed)-this.initial_distance,c=this.speed/this.rotational_speed-this.initial_distance,d=b*this.cos_movement_angle,e=b*this.sin_movement_angle,f=c*this.cos_movement_angle,g=c*this.sin_movement_angle,h={x:this.x0+d,y:this.y0+e},i={x:this.x0+f,y:this.y0+g};return a.create("line_segment_from_points",h,i)},f.delta_t_until_x_is=function(a){if(b(a,this.x0))return 0;var e=a-this.x0,f=e/this.cos_movement_angle,g=(f+this.initial_distance)*(this.rotational_speed/this.speed),h=Math.asin(g);this.clockwise?h=c(h,this.initial_theta):h=d(h,this.initial_theta);var i=(h-this.initial_theta)/this.rotational_speed;return i},f.delta_t_until_y_is=function(a){if(b(a,this.y0))return 0;var e=a-this.y0,f=e/this.sin_movement_angle,g=(f+this.initial_distance)*(this.rotational_speed/this.speed),h=Math.asin(g);this.clockwise?h=c(h,this.initial_theta):h=d(h,this.initial_theta);var i=(h-this.initial_theta)/this.rotational_speed;return i},f.delta_t_until_at=function(a,b){var c=this.delta_t_until_x_is(a);if(c===!1)return!1;var d=this.delta_t_until_y_is(b);if(d===!1)return!1;var e=Math.max(c,d);return e<=0?!1:e},f.get_movement_angle=function(){return this.movement_angle},f.get_rotational_speed=function(){return this.rotational_speed}}(i);var j=function(a){this.super_constructor.call(this,a),this.type="rotating_stationary",this.theta0=a.theta0,this.rotational_speed=a.rotational_speed,this.clockwise=this.rotational_speed>0};a.oo_extend(j,e),function(a){var b=a.prototype;b.get_position=function(a){return{x:this.x0,y:this.y0}},b.delta_t_until_theta_is=function(a){this.clockwise?a=c(a,this.theta0):a=d(a,this.theta0);var b=a-this.theta0;return b/this.rotational_speed}}(j),a.define_factory("stationary_path",function(a){return new f(a)}),a.define_factory("constant_velocity_line_path",function(a){return new g(a)}),a.define_factory("constant_velocity_circle_path",function(a){return new h(a)}),a.define_factory("sinusoidal_velocity_line_path",function(a){return new i(a)}),a.define_factory("rotating_stationary_path",function(a){return new j(a)})}(BrawlIO),function(a){var b=1e-6,c=a.close_to,d=a._,e=function(a,b){while(a>b)a-=2*Math.PI;while(a<b)a+=2*Math.PI;return a},f=function(a,b){while(a<b)a+=2*Math.PI;while(a>b)a-=2*Math.PI;return a},g=function(a,b){var c=e(a,b),d=e(b,a);return Math.min(c-b,d-a)},h=function(a,b,c){var d=a.distance_to(b);return d<=c+1e-5},i=function(a,c,g,i){var j,k,l,m,n,o,p,q,r;if(g.is("stationary"))return!1;if(g.is("constant_velocity_line")){var s=g.get_ray();return j=s.intersects_with(a,i),j===!0?{time:0,event_type:"A"}:j===!1?!1:(k=d(j).chain().map(function(a){var b=g.delta_t_until_at(a.x,a.y);return b}).filter(function(a){return a!==!1&&a>0}).value(),k.length===0?!1:{time:Math.min.apply(Math,k),event_type:"B"})}if(g.is("constant_velocity_circle")){var t=g.get_circle();return l=c.normalize(i),m=a.shift_by_vector(l),j=t.intersects_with_line_segment(m),j===!1?!1:(k=d(j).chain().map(function(a){var b=g.delta_t_until_at(a.x,a.y);return b}).filter(function(a){return a!==!1&&a>0}).value(),k.length===0?!1:{time:Math.min.apply(Math,k),event_type:"C"})}if(g.is("sinusoidal_velocity_line")){n=g.get_position(0);if(h(a,n,i)){o=g.clockwise,p=c.get_theta(),q=p+(o?-Math.PI/2:Math.PI/2),o?q=e(q,g.initial_circle_theta):q=f(q,g.initial_circle_theta);var u=q-g.initial_circle_theta;return r=u/g.rotational_speed,r<=b?!1:{time:r,event_type:"D"}}var v=g.get_line_segment_range();return l=c.normalize(i),m=a.shift_by_vector(l),j=v.intersects_with(m),j===!1?!1:(k=d(j).chain().map(function(a){var b=g.delta_t_until_at(a.x,a.y);return b}).filter(function(a){return a!==!1&&a>0}).value(),k.length===0?!1:{time:Math.min.apply(Math,k),event_type:"E"})}if(g.is("rotating_stationary")){n=g.get_position(0);if(h(a,n,i))return o=g.clockwise,p=c.get_theta(),q=p+(o?-Math.PI/2:Math.PI/2),r=g.delta_t_until_theta_is(q),{time:r,event_type:"F"}}return!1},j=function(d,e,f,i){var j,k,l,m,n,o=f.get_position(0);if(h(d,o,i)){if(f.is("stationary"))return f;if(f.is("constant_velocity_line"))return j=f.get_vector(),k=Math.abs(j.dot(e)),l=e.normalize(k),m=j.add(l),c(m.get_magnitude(),0)?a.create("stationary_path",{x0:o.x,y0:o.y,debug_info:{name:"Stationary after hit line",wall:d}}):a.create("constant_velocity_line_path",{x0:o.x,y0:o.y,angle:m.get_theta(),speed:m.get_magnitude(),debug_info:{name:"Line after hit line",wall:d}});if(f.is("constant_velocity_circle")){j=f.get_vector(0);var p=j.get_theta();n=e.get_theta();if(g(n,p)<=Math.PI/2+b)return f;var q=f.get_rotational_speed(),r=f.get_translational_speed(),s=q>0,t=n+(s?-Math.PI/2:Math.PI/2),u=p-t;return a.create("sinusoidal_velocity_line_path",{x0:o.x,y0:o.y,movement_angle:t,rotational_speed:q,initial_theta:u,initial_circle_theta:p,speed:r,debug_info:{name:"Sinusoidal velocity line after circle hit wall",wall:d}})}if(f.is("sinusoidal_velocity_line")){var v=f.get_movement_angle();j=a.create("vector_from_magnitude_and_angle",f.speed,v),k=Math.abs(j.dot(e)),l=e.normalize(k),m=j.add(l),n=e.get_theta();var w=m.get_theta();return g(n,f.initial_circle_theta)<=Math.PI/2+b?f:c(m.get_magnitude(),0)||!0?a.create("rotating_stationary_path",{x0:o.x,y0:o.y,theta0:f.initial_circle_theta,rotational_speed:f.get_rotational_speed(),debug_info:{name:"rotating stationary after sinusoidal circle hit wall",wall:d}}):a.create("sinusoidal_velocity_line_path",{x0:o.x,y0:o.y,movement_angle:w,rotational_speed:f.rotational_speed,initial_theta:f.initial_theta,initial_circle_theta:v,speed:m.get_magnitude(),debug_info:{name:"sinusoidal after sinusoidal hit",wall:d}})}}return f};a.restrict_path=j,a.next_segment_path_event=i}(BrawlIO),function(a){var b=a._,c=a.root_finder,d=1e-6,e=.001,f=function(a,b,c){return function(d){var e=a.get_position(d),f=b.get_position(d),g=e.x,h=e.y,i=f.x,j=f.y;return Math.sqrt(Math.pow(i-g,2)+Math.pow(j-h,2))-c}},g=function(a,g){var h=a.get_path(),i=g.get_path(),j=a.get_moving_object(),k=g.get_moving_object(),l=j.get_radius(),m=k.get_radius(),n=l+m;if(h.is("constant_velocity_line")){var o=i.get_position(0),p=h.get_line(),q=p.distance_to(o);if(q>n+d)return!1;var r=p.get_normals(),s=b.min(r,function(a){var b={x:o.x+a.x,y:o.y+a.y};return p.distance_to(b)}),t=s.normalize(q),u={x:o.x+t.x,y:o.y+t.y},v=Math.pow(n,2)-Math.pow(q,2);if(v<0)return!1;var w=Math.sqrt(v),x=p.get_theta(),y=w*Math.cos(x),z=w*Math.sin(x),A={x:u.x+y,y:u.y+z},B={x:u.x-y,y:u.y-z},C=h.delta_t_until_at(A.x,A.y),D=h.delta_t_until_at(B.x,B.y),E;return C===!1&&D===!1?!1:(C===!1&&D!==!1?E=D:C!==!1&&D===!1?E=C:E=Math.min(C,D),{time:E,event_type:"Moving Object Hit A"})}var F=f(h,i,n-e),G=c(F,0,1);return G===!1?!1:{time:G,event_type:"Moving Object Hit A (root finder)"}},h=function(a,b){var d=a.get_path(),g=b.get_path(),h=a.get_moving_object(),i=b.get_moving_object(),j=h.get_radius(),k=i.get_radius(),l=j+k,m;if(d.is("constant_velocity_line")&&g.is("constant_velocity_line")){var n=a.x0,o=a.y0,p=a.translational_velocity.angle+a.theta0,q=a.translational_velocity.speed*Math.cos(p),r=a.translational_velocity.speed*Math.sin(p),s=b.x0,t=b.y0,u=b.translational_velocity.angle+b.theta0,v=b.translational_velocity.speed*Math.cos(u),w=b.translational_velocity.speed*Math.sin(u),x=v-q,y=s-n,z=w-r,A=t-o,B=Math.pow(2*x*y+2*z*A,2)-4*(x*x+z*z)*(y*y+A*A-l*l);if(B<0)return!1;var C=(Math.sqrt(B)-2*x*y-2*z*A)/(2*(x*x+z*z)),D=(-1*Math.sqrt(B)-2*x*y-2*z*A)/(2*(x*x+z*z));return m=Math.min(C,D),{time:m,event_type:"Moving Object Hit B"}}var E=f(d,g,l-e);return m=c(E,0,1),m===!1?!1:{time:m,event_type:"Moving Object Hit B (root finder)"}},i=function(a,b){var d=a.get_path(),g=b.get_path(),h=a.get_moving_object().get_radius(),i=b.get_moving_object().get_radius(),j=h+i,k=f(d,g,j-e),l=c(k,0,1);return l===!1?!1:{time:l,event_type:"Moving Object Hit C (root finder)"}},j=function(a,b){var d=a.get_path(),g=b.get_path(),h=a.get_moving_object().get_radius(),i=b.get_moving_object().get_radius(),j=h+i,k=f(d,g,j-e),l=c(k,0,1);return l===!1?!1:{time:l,event_type:"Moving Object Hit D (root finder)"}},k=function(a,b){var d=a.get_path(),g=b.get_path(),h=a.get_moving_object().get_radius(),i=b.get_moving_object().get_radius(),j=h+i,k=f(d,g,j-e),l=c(k,0,1);return l===!1?!1:{time:l,event_type:"Moving Object Hit E (root finder)"}},l=function(a,b){var c=a.get_path(),d=b.get_path(),e=c.is("stationary")||c.is("rotating_stationary"),f=d.is("stationary")||d.is("rotating_stationary");if(e&&f)return!1;var l=c.is("constant_velocity_line")||c.is("sinusoidal_velocity_line"),m=d.is("constant_velocity_line")||d.is("sinusoidal_velocity_line");if(l&&f)return g(a,b);if(e&&m)return g(b,a);if(l&&m)return h(a,b);var n=c.is("constant_velocity_circle"),o=d.is("constant_velocity_circle");return n&&f?i(a,b):e&&o?i(b,a):n&&m?j(a,b):l&&o?j(b,a):n&&o?k(a,b):!1};a.get_next_path_path_event=l}(BrawlIO),function(a){var b=function(a){this.options=a,this.round=this.options.round};(function(a){var b=a.prototype;b.get_round=function(){return this.round}})(b);var c=function(a){this.super_constructor.call(this,a),this.player=a.player,this.projectile=a.projectile};a.oo_extend(c,b),function(a){var b=a.prototype;b.get_player=function(){return this.player},b.get_projectile=function(){return this.projectile}}(c);var d=function(a){this.super_constructor.call(this,a),this.projectile=a.projectile,this.hit_player=a.hit_player};a.oo_extend(d,b),function(a){var b=a.prototype;b.get_hit_player=function(){return this.hit_player},b.get_projectile=function(){return this.projectile}}(d),a.define_factory("player_fired_event",function(a){return new c(a)}),a.define_factory("player_hit_event",function(a){return new d(a)})}(BrawlIO),function(a){var b=a._,c=function(c){this.shape=c.shape,this.x0=c.x0,this.y0=c.y0,this.theta0=c.theta0;var d=b.extend({speed:0,angle:0},c.translational_velocity),e=c.rotational_velocity||0;this.state={translational_velocity:d,rotational_velocity:e},a.make_listenable(this),this.type=c.type};(function(a){var c=a.prototype;c.set_velocity=function(a,b,c){this.state.translational_velocity.speed=a,this.state.translational_velocity.angle=b,this.emit({type:"state_change",round:c,change_type:"Set Translational Velocity"})},c.set_rotation_speed=function(a,b){this.state.rotational_velocity=a,this.emit({type:"state_change",round:b,change_type:"Set Rotational Velocity"})},c.get_shape=function(){return this.shape},c.get_state=function(){return b.clone(this.state)},c.is=function(a){return this.type===a},c.is_touching=function(a){return!1},c.can_collide_with=function(a){return!0}})(c),a.define_type("MovingObject",c)}(BrawlIO),function(a){var b=a.close_to,c=function(a){this.moving_object=a.moving_object,this.x0=a.x0,this.y0=a.y0,this.theta0=a.theta0,this.rotational_velocity=a.rotational_velocity,this.translational_velocity=a.translational_velocity,this.game=a.game,this.specified_path=this.get_specified_path()};return function(c){var d=c.prototype;d.get_moving_object=function(){return this.moving_object},d.get_position_after=function(a){var b=this.get_path(),c=b.get_position(a);return{x:c.x,y:c.y,theta:this.theta0+a*this.get_rotational_velocity()}},d.get_x0=function(){return this.x0},d.get_y0=function(){return this.y0},d.get_theta0=function(){return this.theta0},d.get_rotational_velocity=function(){return this.rotational_velocity},d.get_translational_speed=function(){return this.translational_velocity.speed},d.get_translational_angle=function(){return this.translational_velocity.angle},d.get_specified_path=function(){var c=this.get_translational_speed(),d=this.get_rotational_velocity(),e;return b(c,0)?a.create("stationary_path",{x0:this.get_x0(),y0:this.get_y0()}):b(d,0)?(e=this.get_theta0()+this.get_translational_angle(),a.create("constant_velocity_line_path",{x0:this.get_x0(),y0:this.get_y0(),speed:this.get_translational_speed(),angle:e})):(e=this.get_theta0()+this.get_translational_angle(),a.create("constant_velocity_circle_path",{x0:this.get_x0(),y0:this.get_y0(),movement_angle:e,speed:this.get_translational_speed(),rotational_speed:this.get_rotational_velocity()}))},d.get_path=function(){return this.path},d.get_next_event=function(b){return a.get_next_path_path_event(this,b)},d.is_touching=function(a,b){b=b||0;var c=this.get_position_after(b),d=a.get_position_after(b),e=c.x,f=c.y,g=d.x,h=d.y;return Math.sqrt(Math.pow(e-g,2)+Math.pow(f-h,2))},d.restrict_path=function(a){}}(c),c}(BrawlIO),function(a){var b=a.get_type("MovingObject"),c=1e-4,d=function(b){var c=2;this.code=b.code,this.super_constructor.call(this,{shape:a.create("circle_shape",{radius:c}),type:"player"}),this.attributes={max_movement_speed:5,max_rotation_speed:90*Math.PI/180,max_health:10,max_firing_angle_offset:Math.PI/8,shots_per_round:1},this.health=this.get_max_health(),this.auto_fire=!1,this.next_fireable_round=0,this.options=b};a.oo_extend(d,b),function(b){var d=b.prototype;d.get_attributes=function(){return this.attributes},d.get_attribute=function(a){return this.attributes[a]},d.set_attribute=function(a,b){this.attributes[a]=b},d.get_max_movement_speed=function(){return this.get_attribute("max_movement_speed")},d.set_game=function(a){this.game=a},d.get_game=function(){return this.game},d.get_round=function(){var a=this.get_game();return a.get_round()},d.get_code=function(){return this.options.code},d.get_team=function(){return this.options.team},d.get_number=function(){return this.options.number},d.serialize=function(){return{code:this.get_code(),number:this.get_number()}},d.get_radius=function(){return this.shape.get_radius()},d.get_max_rotation_speed=function(){return this.get_attribute("max_rotation_speed")},d.get_max_health=function(){return this.get_attribute("max_health")},d.get_health=function(){return this.health},d.is_alive=function(){return this.get_health()>0},d.is_dead=function(){return!this.is_alive()},d.remove_health=function(a){return this.health-=a,this.is_alive()},d.is_auto_fire=function(){return this.auto_fire},d.set_auto_fire=function(a){this.auto_fire=a},d.can_fire=function(){var a=this.get_game(),b=a.get_round();return b+c>this.get_next_fireable_round()},d.get_next_fireable_round=function(){return this.next_fireable_round},d.set_next_fireable_round=function(){var a=this.get_game(),b=a.get_round(),c=1/this.get_attribute("shots_per_round"),d=b+c;return this.next_fireable_round=d,d},d.on_fire=function(a){this.set_next_fireable_round();var b=this.get_game();this.emit({type:"fire",fired:!0,round:b.get_round()})},d.on_fire_fail=function(a){this.emit({type:"fire",fired:!1})},d.fire=function(a){this.can_fire()?this.on_fire(a):this.on_fire_fail();var b=this,c=this.get_game();c.on_round(function(){b.is_auto_fire()&&b.fire()},this.get_next_fireable_round(),"Fire")},d.can_collide_with=function(a){return a.is("projectile")?a.get_fired_by()!==this:a.is("player")?!1:!0},d.restrict_path=function(b,c){return b.is("player")?a.create("stationary_path",{x0:0,y0:0}):c}}(d),a.define_factory("player",function(a){return new d(a)})}(BrawlIO),function(a){var b=a.get_type("MovingObjectState"),c=function(a){this.super_constructor.call(this,a),this.health=a.health,this.path=this.game.restrict_path(this.moving_object,this.specified_path)};a.oo_extend(c,b),function(a){var b=a.prototype;b.get_health=function(){return this.health}}(c),a.define_factory("player_state",function(a){return new c(a)})}(BrawlIO),function(a){var b=a._,c=a.get_type("MovingObject"),d=function(c){var d=c.radius;this.super_constructor.call(this,b.extend({shape:a.create("circle_shape",{radius:d}),translational_velocity:{speed:0},type:"projectile"},c)),this.fired_by=c.fired_by,this.initialized=!1};a.oo_extend(d,c),function(a){var b=a.prototype;b.get_radius=function(){return this.shape.get_radius()},b.can_collide_with=function(a){return a.is("player")?a.can_collide_with(this):!0},b.get_fired_by=function(){return this.fired_by}}(d),a.define_factory("projectile",function(a){return new d(a)})}(BrawlIO),function(a){var b=a.get_type("MovingObjectState"),c=function(a){this.super_constructor.call(this,a),this.path=this.specified_path};a.oo_extend(c,b),function(a){}(c),a.define_factory("projectile_state",function(a){return new c(a)})}(BrawlIO),function(a){var b=function(a){this.shape=a.shape};(function(a){var b=a.prototype;b.next_touch_event=function(a,b){return!1},b.is_touching=function(a,b){return!1},b.restrict_path=function(a,b){return b},b.get_shape=function(){return this.shape}})(b),a.define_type("StaticObstacle",b)}(BrawlIO),function(a){var b=a._,c=a.get_type("StaticObstacle"),d=1e-5,e=function(b){var c=a.create("polygon",{points:b.points,inverted:b.inverted});this.super_constructor.call(this,{shape:c})};a.oo_extend(e,c),function(c){var e=c.prototype;e.get_line_segments=function(){return this.shape.get_line_segments()},e.next_touch_event=function(c,d){var e=c.get_shape(),f=this.get_line_segments(),g=d.get_path(),h=this.get_shape(),i=b.map(f,function(c){var d=h.get_normal(c),f=a.next_segment_path_event(c,d,g,e.get_radius());return f===!1?!1:f===!0?b.extend(f,{line_segment:c}):b.extend(f,{line_segment:c})}).filter(function(a){return a!==!1}),j=!1;return i.forEach(function(a){if(j===!1||a.time<j.time)j=a}),j===!1?!1:j},e.restrict_path=function(c,d){var e=c.get_shape(),f=d,g=this.get_line_segments(),h=this.get_shape();return b.forEach(g,function(b){var c=h.get_normal(b);f=a.restrict_path(b,c,f,e.get_radius())}),f},e.is_touching=function(a,b){var c=this.get_line_segments(),e,f=c.length,g=a.get_shape(),h=g.get_radius();for(e=0;e<f;e++){var i=c[e];if(i.distance_to(b)<=h+d)return!0}return!1}}(e),a.define_type("PolygonObstacle",e)}(BrawlIO),function(a){var b=a.get_type("PolygonObstacle"),c=function(a){var b=a.width||50,c=a.height||50;this.super_constructor.call(this,{points:[{x:0,y:0},{x:b,y:0},{x:b,y:c},{x:0,y:c}],inverted:!0})};a.oo_extend(c,b),a.define_factory("map_boundary_obstacle",function(a){return new c(a)})}(BrawlIO),function(a){var b=a._,c=function(a){this.game=a.game,this.complete=a.complete||!1,this.game_events=[]};(function(a){var c=a.prototype;c.get_map=function(){return this.game.get_map()},c.add_moving_object=function(a,b,c){var d={object:a,appears_at:b,disappears_at:c};this.objects.push(d)},c.is_complete=function(){return this.complete},c.get_snapshot_at=function(a){var b=this.game,c=b.get_moving_object_states(a),d=this.get_map();return{round:a,moving_object_states:c,map:{width:d.get_width(),height:d.get_height()}}},c.get_game_events=function(){return this.game_events},c.get_game_events.between=function(a,c){return b.filter(this.get_game_events(),function(b){var d=b.get_round();return d>=a&&d<c})},c.push_game_event=function(a){this.game_events.push(a)},c.get_num_rounds=function(){return this.last_round},c.set_num_rounds=function(a){this.last_round=a},c.set_winner=function(a){this.winner=a},c.get_winner=function(){return this.winner}})(c),a.define_factory("replay",function(a){return new c(a)})}(BrawlIO),function(a){var b=a._,c=function(c){this.name=c.name,this.id=c.id;var d=this;this.players=b.map(c.players,function(c,e){return a.create("player",b.extend({number:e,team:d},c))})};(function(a){var b=a.prototype;b.is_alive=function(){var a=this.get_players(),b,c=a.length;for(b=0;b<c;b++)if(a[b].is_alive())return!0;return!1},b.is_dead=function(){return!this.is_alive()},b.get_players=function(){return this.players},b.num_players=function(){return this.get_players().length},b.get_id=function(){return this.id},b.set_id=function(a){this.id=a},b.get_name=function(){return this.name}})(c),a.define_factory("team",function(a){return new c(a)})}(BrawlIO),function(a){var b=a._,c=function(c){c===undefined&&(c={}),this.attributes=b.extend({width:50,height:50,start_positions:[[{x:10,y:10,theta:0}],[{x:40,y:40,theta:0}]]},c),this.obstacles=[a.create("map_boundary_obstacle",{width:this.get_width(),height:this.get_height()})]};(function(a){var c=a.prototype;c.get_width=function(){return this.attributes.width},c.get_height=function(){return this.attributes.height},c.get_start_positions=function(){return this.attributes.start_positions},c.get_next_event=function(a,c){var d=b(this.obstacles).chain().map(function(d){var e=d.next_touch_event(a,c);return e===!1?!1:b.extend({obstacle:d},e)}).filter(function(a){return a!==!1}).value(),e=!1;return d.forEach(function(a){if(e===!1||a.time<e.time)e=a}),e===!1?!1:e},c.restrict_path=function(a,c){var d=c;return b(this.obstacles).forEach(function(b){d=b.restrict_path(a,d)}),d},c.is_touching=function(a,b){var c,d=this.obstacles.length;for(c=0;c<d;c++){var e=this.obstacles[c];if(e.is_touching(a,b))return!0}return!1},c.get_constraining_obstacles=function(a,c){var d=b(this.obstacles).chain().map(function(b){return{obstacle:b,signature:b.touching(a,c)}}).filter(function(a){return a.signature!==0}).value();return d}})(c),a.define_factory("map",function(a){return new c(a)})}(BrawlIO),function(a){var b=a._,c=1e-5,d=function(b){this.start_round=b.round,this.start_time=a.get_time(),this.trigger_action=b.trigger,this.end_round=undefined,this.moving_object_states=b.moving_object_states};(function(a){var c=a.prototype;c.set_end_round=function(a){this.end_round=a},c.is_relevant_to_round=function(a){return a>=this.start_round&&(this.end_round===undefined||a<this.end_round)},c.get_state_for_moving_object=function(a){var b,c=this.moving_object_states.length;for(b=0;b<c;b++){var d=this.moving_object_states[b];if(d.get_moving_object()===a)return d}return undefined},c.get_moving_object_position_on_round=function(a,b){var c=this.get_state_for_moving_object(a);if(c===undefined)return undefined;var d=b-this.start_round;return c.get_position_after(d)},c.get_moving_object_states=function(a,c){var d=a-this.start_round;return b.map(this.moving_object_states,function(a){var b={position:a.get_position_after(d),moving_object:a.get_moving_object()};return c&&(b.state=a),b})}})(d);var e=function(a){this.on_round=a.on_round,this.callback=a.callback,this.description=a.description,this.timeout_id=undefined,this.for_state=undefined};(function(a){var b=a.prototype;b.set_timeout=function(a){a<0?this.callback():this.timeout_id=setTimeout(this.callback,a)},b.clear_timeout=function(){clearTimeout(this.timeout_id)},b.get_round=function(){return this.on_round}})(e);var f=function(a){this.projectile=a.projectile,this.other_object=a.other_object};(function(a){var b=a.prototype;b.get_projectile=function(){return this.projectile},b.get_other_object=function(){return this.other_object}})(f);var g=function(b){this.teams=b.teams,this.map=b.map,this.round_limit=b.round_limit,a.make_listenable(this),this.states=[],this.round_listeners=[],this.replay=a.create("replay",{game:this}),this.initialize(),this.active_projectiles=[],this.special_timeouts={end_game:undefined,next_interesting_round:undefined},this.running=!1,this.debug_mode=b.debug_mode===!0};(function(c){var g=c.prototype;g.initialize=function(){var a=this;b.map(this.get_players(),function(b){a.initialize_player(b)})},g.initialize_player=function(a){var b=this;a.set_game(this),a.on("state_change",function(a){var c=a.round,d=a.change_type;b.update_state(c,d)}),a.on("fire",function(c){if(c.fired){var d=c.round;b.on_player_fire(a,d)}})},g.get_players=function(){return b(this.teams).chain().map(function(a){return a.get_players()}).flatten().value()},g.get_living_players=function(){return b.filter(this.get_players(),function(a){return a.is_alive()})},g.check_for_collision=function(){var a=this.get_round();this.has_projectile_collision(a)&&this.update_state(a,"Hackey projectile collision detection")},g.get_projectiles=function(){return this.active_projectiles},g.add_projectile=function(b,c){this.active_projectiles.push(b);var d=a.create("player_fired_event",{fired_by:b.get_fired_by(),projectile:b});this.replay.push_game_event(d),this.update_state(c,"Fire")},g.remove_projectile=function(c,d){var e=b.indexOf(this.active_projectiles,c);e>=0&&this.active_projectiles.splice(e,1);var f=a.create("projectile_removed_event",{projectile:c});this.replay.push_game_event(f),this.update_state(d,"Projectile hit")},g.get_active_moving_objects=function(){return this.get_living_players().concat(this.get_projectiles())},g.on_player_fire=function(b,c){var d=this.get_moving_object_position_on_round(b,c),e=b.get_radius(),f=1,g=e+f,h=g*Math.cos(d.theta),i=g*Math.sin(d.theta),j=d.x+h,k=d.y+i,l=a.create("projectile",{radius:f,x0:j,y0:k,theta0:d.theta,translational_velocity:{speed:a.game_constants.PROJECTILE_SPEED},fired_by:b});this.add_projectile(l,c)},g.start=function(){this.running=!0,this.update_state(0,"Game Started");if(this.round_limit!==undefined){var a=this;this.special_timeouts.end_game=this.on_round(function(){a.stop(undefined)},this.round_limit,"End of game")}this.emit({type:"start"})},g.stop=function(a){this.clear_round_listeners(),this.replay.complete=!0,this.replay.set_num_rounds(this.get_round()),this.replay.set_winner(a),this.running=!1,this.emit({type:"end",winner:a})},g.get_map=function(){return this.map},g.on_round=function(a,b,c){var d=b-this.get_round();if(d<=0)return a(b),undefined;var f=this,g;return g=new e({on_round:b,callback:function(){f.remove_round_listener(g),a(b)},description:c}),this.round_listeners.push(g),this.update_round_listeners(),g},g.remove_round_listener=function(a){a.clear_timeout(),this.round_listeners=b.without(this.round_listeners,a)},g.clear_round_listeners=function(){b.forEach(this.round_listeners,function(a){a.clear_timeout()}),this.round_listeners=[]},g.update_round_listeners=function(){var c=this,d=this.peek_state();b.forEach(this.round_listeners,function(b){if(b.for_state!==d){b.for_state=d,b.clear_timeout();var e=b.get_round()-c.get_round(),f=e*a.game_constants.SIM_MS_PER_ROUND;b.set_timeout(f)}})},g.get_round=function(b){var c=this.peek_state();if(c===undefined)return 0;b=b||a.get_time();var d=b-c.start_time,e=d/a.game_constants.SIM_MS_PER_ROUND;return c.start_round+e},g.push_state=function(a){var b=a.round,c=this.peek_state();c!==undefined&&c.set_end_round(b);var e=new d(a);this.states.push(e),this.update_round_listeners()},g.peek_state=function(){return b.last(this.states)},g.update_state=function(a,b,c){this.debug_mode&&console.log("------",a,b,"------"),this.clear_interesting_round_timeout(),this.handle_projectile_collisions(a),this.push_state({round:a,trigger:b,more_info:c,moving_object_states:this.create_moving_object_states(a)});var d=this.get_next_touch_event();if(d!==!1){var e=a+d.time;this.set_interesting_round_timeout(e,d)}},g.set_interesting_round_timeout=function(a,b){var c=this;this.special_timeouts.next_interesting_round=this.on_round(function(){c.update_state(a,"Interesting Round ("+b.event_type+")")},a,"Update timer")},g.clear_interesting_round_timeout=function(){this.special_timeouts.next_interesting_round!==undefined&&(this.remove_round_listener(this.special_timeouts.next_interesting_round),this.special_timeouts.next_interesting_round=undefined)},g.get_next_touch_event=function(){var a=this.get_next_map_event(),b=this.get_next_moving_object_event();return a===!1?b:b===!1?a:a.time<b.time?a:b},g.get_next_map_event=function(){var a=this.get_active_moving_objects(),c=this.get_map(),d=this.peek_state(),e=b(a).chain().map(function(a){var b=d.get_state_for_moving_object(a),e=c.get_next_event(a,b);return e}).without(!1).value(),f=!1;return e.forEach(function(a){if(f===!1||a.time<f.time)f=a}),f===!1?!1:f},g.get_next_moving_object_event=function(){var a=this.get_active_moving_objects(),b=this.peek_state(),c,d,e=a.length,f=[];for(c=0;c<e-1;c++){var g=a[c],h=b.get_state_for_moving_object(g);for(d=c+1;d<e;d++){var i=a[d];if(g.can_collide_with(i)){var j=b.get_state_for_moving_object(i),k=h.get_next_event(j);k!==!1&&f.push(k)}}}var l=!1;return f.forEach(function(a){if(l===!1||a.time<l.time)l=a}),l===!1?!1:l},g.get_replay=function(){return this.replay},g.get_relevant_state=function(a){var b;for(b=this.states.length-1;b>=0;b--){var c=this.states[b];if(c.is_relevant_to_round(a))return c}return undefined},g.get_moving_object_position_on_round=function(a,b){var c=this.get_relevant_state(b);if(c===undefined)return undefined;var d=c.get_moving_object_position_on_round(a,b);return d===undefined&&a.is("projectile")?{x:a.x0,y:a.y0,theta:a.theta0}:d},g.get_moving_object_states=function(a){var b=this.get_relevant_state(a);if(b===undefined)return undefined;var c=this.debug_mode;return b.get_moving_object_states(a,c)},g.create_moving_object_states=function(c){var d=this,e;if(c===0){var f=this.get_map();e=b.flatten(f.get_start_positions())}else e=b.map(this.get_players(),function(a){return d.get_moving_object_position_on_round(a,c)});var g=b.map(this.get_players(),function(c,f){var g=e[f];return a.create("player_state",b.extend({moving_object:c,x0:g.x,y0:g.y,theta0:g.theta,health:c.get_health(),game:d},c.get_state()))}),h=b.map(this.get_projectiles(),function(e,f){var g=d.get_moving_object_position_on_round(e,c);return g===undefined?a.create("projectile_state",b.extend({moving_object:e,x0:e.x0,y0:e.y0,theta0:e.theta0,game:d},e.get_state())):a.create("projectile_state",b.extend({moving_object:e,x0:g.x,y0:g.y,theta0:g.theta,game:d},e.get_state()))});return g.concat(h)},g.restrict_path=function(a,b){var c=this.get_map(),d=b;return d=c.restrict_path(a,d),d},g.handle_projectile_collisions=function(a){var c=this.get_projectile_collisions(a),d=this;b.forEach(c,function(b){d.handle_projectile_collision(b,a)})},g.handle_projectile_collision=function(a,c){var d=a.projectile,e=a.other_object;if(e===this.get_map())this.remove_projectile(d,c);else if(e.is("player")){this.remove_projectile(d,c),e.remove_health(6);var f=this;b.defer(function(){f.check_game_over()})}else e.is("projectile")&&(this.remove_projectile(d,c),this.remove_projectile(e,c))},g.get_projectile_collisions=function(a){var c=this.get_active_moving_objects(),d=c.length,e=[],g=this.get_map(),i=this,j,k,l=b.map(c,function(b){return i.get_moving_object_position_on_round(b,a)});for(j=0;j<d;j++){var m=c[j];if(m.is("projectile")){var n=l[j];g.is_touching(m,n)&&e.push(new f({projectile:m,other_object:g}));for(k=0;k<d;k++)if(j!==k){var o=c[k];if(m.can_collide_with(o)){var p=l[j],q=l[k];Math.pow(p.x-q.x,2)+Math.pow(p.y-q.y,2)<=Math.pow(m.get_radius()+o.get_radius(),2)+h&&e.push(new f({projectile:m,other_object:o}))}}}}return e};var h=1e-5;g.has_projectile_collision=function(a){a=a||this.get_round();var c=this.get_active_moving_objects(),d=c.length,e=this,f,g,i=b.map(c,function(b){return e.get_moving_object_position_on_round(b,a)});for(f=0;f<d;f++){var j=c[f];if(j.is("projectile"))for(g=0;g<d;g++)if(f!==g){var k=c[g];if(j.can_collide_with(k)){var l=i[f],m=i[g];if(Math.pow(l.x-m.x,2)+Math.pow(l.y-m.y,2)<=Math.pow(j.get_radius()+k.get_radius(),2)+h)return!0}}}return!1},g.check_game_over=function(){var a=this.get_living_players(),b,c,d=a.length;for(c=0;c<d;c++){var e=a[c],f=e.get_team();if(b===undefined)b=f;else if(b!==f)return!1}this.stop(b)}})(g),a.define_factory("game",function(a){return new g(a)})}(BrawlIO),function(a){var b=a.game_constants.actions,c=a._,d=a.get_time,e=function(b){var d=a.create("map",b.map),e=c.map(b.teams,function(b,d){return a.create("team",c.extend({id:d},b))});this.game=a.create("game",{map:d,teams:e,round_limit:b.round_limit}),this.initialize(),this.asked_to_run=!1,this.workers_ready=!1,this.game_callback=undefined,this.worker_sync_interval=undefined};(function(e){var f=e.prototype;f.initialize=function(){this.create_player_workers()},f.create_player_workers=function(){var a=this,b=this.game.get_players();this._waiting_for_workers=b.length,this.player_workers=c.map(b,function(b){var c=new Worker("game/player_worker.js");return c.onmessage=function(d){var e=d.data;a.on_player_message(b,c,e,d)},c}),this.worker_sync_interval=window.setInterval(function(){c.forEach(a.player_workers,function(b){a.sync_worker(b)})},5e3)},f.terminate_player_workers=function(){c.forEach(this.player_workers,function(a){a.terminate()}),window.clearInterval(this.worker_sync_interval)},f.post=function(a,b){return a.postMessage(b)},f.on_player_message=function(c,d,e){if(e==="ready")this._waiting_for_workers--,this.post(d,{type:"initialize",info:c.serialize()}),this._waiting_for_workers===0&&(delete this._waiting_for_workers,this.workers_ready=!0,this.run_if_ready());else{var f=e.type;if(f==="console.log")console.log.apply(console,e.args);else if(f==="action"){var g=this,h=e,i=h.action,j=a.game_constants.actions.get_type(i),k=h.options||{},l=this.game,m,n,o=function(){};if(k.callback){var p=k.callback_id;o=function(a){g.post(d,{type:"callback",event_id:p,event:a})}}if(j===a.game_constants.actions.move_type)m=k.delay||0,n=function(a){var d=0;i===b.move.forward?d=0:i===b.move.left?d=-1*Math.PI/2:i===b.move.right?d=Math.PI/2:i===b.move.backward&&(d=Math.PI);var e=k.speed||c.get_max_movement_speed();i===b.move.stop&&(e=0),c.set_velocity(e,d,a),o({type:"start",action:i});if(k.duration!==undefined){var f=function(a){c.set_velocity(0,0,a),o({type:"stop",action:i})};l.on_round(f,h.round+m+k.duration,"Stop moving")}},l.on_round(n,h.round+m,"Move");else if(j===b.rotate_type)m=k.delay||0,n=function(a){var d=k.speed||c.get_max_rotation_speed();i===b.rotate.stop?d=0:i===b.rotate.counter_clockwise&&(d*=-1),c.set_rotation_speed(d,a),o({type:"start",action:i});if(k.duration!==undefined){var e=function(a){c.set_rotation_speed(0,a),o({type:"stop",action:i})};l.on_round(e,h.round+m+k.duration,"Stop rotating")}},l.on_round(n,h.round+m,"Rotate");else if(j===b.instantaneous_type)if(i===b.fire){var q=function(){c.set_auto_fire(k.automatic),c.fire()};l.on_round(q,h.round,"Fire")}else if(i===b.stop_firing){var r=function(){c.set_auto_fire(!1)};l.on_round(r,h.round,"Stop firing")}else if(i===b.sense){var s=l.get_snapshot();s.players.forEach(function(a){delete a.player}),o({type:"sense",data:s})}}}},f.run=function(a){this.game_callback=a||undefined,this.asked_to_run=!0,this.run_if_ready()},f.ready_to_run=function(){return this.workers_ready},f.run_if_ready=function(){this.ready_to_run()&&this.asked_to_run&&this.do_run()},f.do_run=function(){var a=this;this.game.on("start",function(){var b=d();c.forEach(a.player_workers,function(c){a.post(c,{type:"game_start",start_time:b})})}),this.game.on("end",function(b){var d=b.winner;c.isFunction(a.game_callback)&&a.game_callback(d)}),this.game.start()},f.terminate=function(){this.terminate_player_workers(),this.game.stop()},f.get_replay=function(){return this.game.get_replay()},f.sync_worker=function(a){var b=this.game.get_round(),c=d();this.post(a,{type:"sync_time",time:c,round:b})}})(e),a.define_factory("brawl",function(a){return new e(a)})}(BrawlIO)